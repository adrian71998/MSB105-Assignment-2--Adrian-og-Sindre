---
title: "Ass 2"
format: html
editor: visual
---

Innledning

Literaturgjennomgang

```{r}
library(tidyverse)
library(dplyr)
library(ggplot2)
library(forcats)
library(modelr)
library(flextable)
library(vtable)
library(labeling)

#| lst-label: lst-read-in-data
#| lst-cap: "Kode for å lese inn data og definere noen nye variabler."
heights <- modelr::heights

heights <- heights %>% 
  mutate(
    bmi = weight * 0.4536/(height * 2.54/100)^2,
    married = fct_collapse(
      .f = marital,
      married = "married",
      other_level = "not married"
    ),
    edu_fac = cut(
      x = education,
      breaks = c(0, 12, 14, 16, 21),
      labels = c("not_hs", "not_cc", "not_col", "col_plus"),
      right = FALSE
    )
  ) |> 
  # reorganiserer data s.a. de fire faktor-variablerne kommer
  # lengst til høyre
  select(income:age, education:bmi, everything()) |>
  # Dropper marital og education siden disse ikke skal brukes
  select(-education, -marital)

# Inntekt lik 0
heightsZeroInc <- heights |> 
  filter(income == 0)
# «Normal» inntekt
heightsNormInc <- heights |> 
  filter(income > 0 & income < 343830)
heightsHighInc <- heights |> 
  filter(income == 343830)


```

Starter på EDA analyse

```{r}
# legger inn deskriptiv statistikk for høyde totalt
#| label: tbl-desc-stat
#| tbl-cap: "Deskreptiv statistikk for datasettet `modelr::heights`."
#| lst-label: lst-heights-st
#| lst-cap: "Kode for å generere deskreptiv-statistikk tabell vha.
#| funksjonene `st()` og `as_flextable()`. Merk bruken av
#| «hash pipes». Her setter vi label og caption for både kode-listing
#|  og resulterende tabell. Hvis det var en figur vi genererte
#|  ville vi byttet ut `tbl-` med `fig-`."
heights |> 
  st(out = "return") |> 
  as_flextable(max_row = 20) |> 
  line_spacing(space = 0.3, part = "all") |> 
  fontsize(size = 9, part = "body") |> 
  fontsize(size = 10, part = "header") |> 
  width(width = 16, unit = "mm") |> 
  delete_part("footer")

# Totalt antall manglende verdier i hele datasettet
total_missing <- heights %>%
  summarize_all(~ sum(is.na(.))) %>%
  summarise(total_missing = sum(across(everything()))) %>%
  pull(total_missing)

print(total_missing)

#| label: tbl-height
#| caption: "Deskriptiv statistikk for høyde."
height_stats <- heights %>%
  summarise(
    Mean = mean(height, na.rm = TRUE),
    SD = sd(height, na.rm = TRUE),
    Min = min(height, na.rm = TRUE),
    Median = median(height, na.rm = TRUE),
    Max = max(height, na.rm = TRUE)
  )

print(height_stats)


#| label: tbl-zeroInc
#| tbl-cap: "Deskriptiv statistikk for delsettet med ingen inntekt."
heights |>
  filter(income == 0) |>
  st(out = "return") |>
  as_flextable(max_row = 20) |>
  line_spacing(space = 0.3, part = "all") |>
  fontsize(size = 9, part = "body") |>
  fontsize(size = 10, part = "header") |>
  width(width = 16, unit = "mm") |>
  delete_part("footer")


#|label: tbl-normInc
#| tbl-cap: "Deskriptiv statistikk for delsettet med normal inntekt."
heights %>%
  filter(income > 0 & income < 343830) %>%
  st(out = "return") %>%
  as_flextable(max_row = 20) %>%
  line_spacing(space = 0.3, part = "all") %>%
  fontsize(size = 9, part = "body") %>%
  fontsize(size = 10, part = "header") %>%
  width(width = 16, unit = "mm") %>%
  delete_part("footer")


#| label: tbl-highInc
#| tbl-cap: "Deskriptiv statistikk for delsettet med høy inntekt."
heights %>%
  filter(income >= 343830) %>%
  st(out = "return") %>%
  as_flextable(max_row = 20) %>%
  line_spacing(space = 0.3, part = "all") %>%
  fontsize(size = 9, part = "body") %>%
  fontsize(size = 10, part = "header") %>%
  width(width = 16, unit = "mm") %>%
  delete_part("footer")


```

Forskjeller mellom de tre inntektsgruppene.

Enorm forskjell på utdanning for de tre gruppene.
Blant de med høyest inntekt har hele 82% collage plus utdanning, mens de med nullintekt har bare 11% utdanning på dette nivået.

Det virker å være noe mindre forskjeller på høyde og bmi.
Det kan virke som høye personer tjener mer ettersom gjennomsnittet blant de med høy inntekt er merbart høyere.
Men dette virker å ha en naturlig sammenheng med at andelen menn i denne kategorien er høy.
Og menn vil naturligvis dra opp gjennomsnittet.

Det er også interessant hvordan andelen gifte personer er ulik for de ulike gruppene.
Blant de med gjennomsnittelig inntekt er det merbart flere gifte personer enn de med nullinntekt.
Mens andel gifte virker å øke betraktelig igjen blant de med høyest inntekt.

Som vi var inne på over er menn svært dominerende blant de med høyest inntekt.
Blant de med nullinntekt er kvinner noe overrepresentert, mens det er relativt jevnt fordelt blant de med normale inntekter.

Går over til å splitte på kjønn

```{r}

#| eval: false
#| ft_max_row: 15
# Default for ft_max_row is 10
# so just first 10 lines will
# be printed
use_df_printer()
heights %>%
  vtable::st(
    group = 'sex',
    group.long = TRUE,
    out = "return"
    )



height_zero_inc_male <- heights |>
  filter(sex == 'male' & income ==0) |>
  st(out = "return") |>
  as_flextable(max_row = 20) |>
  line_spacing(space = 0.3, part = "all") |>
  fontsize(size = 9, part = "body") |>
  fontsize(size = 10, part = "header") |>
  width(width = 16, unit = "mm") |>
  delete_part("footer")
height_zero_inc_male

heights_zero_inc_female <- heights %>%
  filter(sex == 'female' & income ==0) |>
  st(out = "return") |>
  as_flextable(max_row = 20) |>
  line_spacing(space = 0.3, part = "all") |>
  fontsize(size = 9, part = "body") |>
  fontsize(size = 10, part = "header") |>
  width(width = 16, unit = "mm") |>
  delete_part("footer")
heights_zero_inc_female


heightsNormIncFemale <- heightsNormInc %>%
  filter(sex == 'female') %>%
  st(out = "return") |>
  as_flextable(max_row = 20) |>
  line_spacing(space = 0.3, part = "all") |>
  fontsize(size = 9, part = "body") |>
  fontsize(size = 10, part = "header") |>
  width(width = 16, unit = "mm") |>
  delete_part("footer")
heightsNormIncFemale

heightsNormIncMale <- heightsNormInc %>%
  filter(sex == 'male') |>
  st(out = "return") |>
  as_flextable(max_row = 20) |>
  line_spacing(space = 0.3, part = "all") |>
  fontsize(size = 9, part = "body") |>
  fontsize(size = 10, part = "header") |>
  width(width = 16, unit = "mm") |>
  delete_part("footer")
heightsNormIncMale

heightsHighIncMale <- heightsHighInc %>%
  filter(sex == 'male') |>
  st(out = "return") |>
  as_flextable(max_row = 20) |>
  line_spacing(space = 0.3, part = "all") |>
  fontsize(size = 9, part = "body") |>
  fontsize(size = 10, part = "header") |>
  width(width = 16, unit = "mm") |>
  delete_part("footer")
heightsHighIncMale

heightsHighIncFemale <- heightsHighInc %>%
  filter(sex == 'female') |>
  st(out = "return") |>
  as_flextable(max_row = 20) |>
  line_spacing(space = 0.3, part = "all") |>
  fontsize(size = 9, part = "body") |>
  fontsize(size = 10, part = "header") |>
  width(width = 16, unit = "mm") |>
  delete_part("footer")
heightsHighIncFemale

```

-   Diskuter forskjellene mellom disse seks gruppene.

```{=html}
<!-- -->
```
-   For datasettet *normal inntekt*

    -   Er det noen interessante sammenhenger mht.
        noen av de andre variablene?

    -   Diskuter eventuelle funn

-   Diskuter om det som fremkommer fra den deskreptive statistikken dere har generert ovenfor samsvar med funn i literaturen.

GGPLOTS

```{r}
#| label: fig-norm-inc
#| fig-cap: "Plot av inntekt mot høyde. Fra modell-linjen som er
#| lagt inn ser vi at det ser ut til å være en positiv sammenheng
#|  mellom høyde og inntekt. Vi merker oss også de horisontale
#|  båndene for inntekt lik 0 og en inntekt litt over 300000."
#| lst-label: lst-norm-inc-plot
#| lst-cap: "Kode for å generere «scatterplot» vha. `ggplot2`."
heightsNormInc  |> 
  ggplot(
  mapping = aes(
    x = height,
    y = income,
    color = sex
    )
  ) + 
  geom_jitter(
    size = 1,
    alpha = 0.40
    ) +
  geom_smooth(
    formula = y ~ x,
    method = "lm",
    colour = "black",
    lwd = 0.75,
    se = FALSE
    ) +
  geom_smooth(
    aes(colour = sex),
    formula = y ~ x,
    method = "lm",
    lwd = 0.75,
    se = FALSE)
 

```

Diskuter hva plottet over viser.

```{r}
heightsNormInc %>%
  ggplot(
    mapping = aes(
      x = income
      )
    ) +
  geom_histogram(
    bins = 30)

heightsNormInc %>%
  ggplot(
    mapping = aes(
      x = height
      )
    ) +
  geom_histogram(
    bins = 30)


heightsNormInc %>%
ggplot(aes(
  x = income)
  ) +
  geom_histogram(aes(
    y = ..density..),
    bins = 30,
    fill = "green",
    alpha = 0.6,
    color = "black"
    ) + 
  geom_density(
    color = "red",
    size = 1
    ) + 
  labs(title = "Fordeling av inntekt",
       x = "Inntekt",
       y = "Tetthet") +
  theme_minimal()
```

\
